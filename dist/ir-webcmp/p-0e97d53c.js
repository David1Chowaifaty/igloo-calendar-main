import{h as n}from"./p-b1914e38.js";import{i as T,b as E}from"./p-a1c174d3.js";import{l as t,a as _,b as o}from"./p-6cbdded4.js";async function O(n){const T=[];const E=await c();for(const t of n){for(const n of t.days){for(const t of n.room_types){A(t.physicalrooms,T,E)}}}return T}function A(n,T,E){for(const t of n){for(const n in t.calendar_cell){if(t.calendar_cell[n].Is_Available===false){a(t.calendar_cell[n],T,E)}}}}const r={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const i={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function e(n,T){if(n===null&&T===null)return"";if(T!==null){return`${n!==null&&n!==void 0?n:""} , ${T!==null&&T!==void 0?T:""}`}return n}async function c(){try{const n=o.token;if(n){const{data:T}=await _.post(`/Get_Setup_Entries_By_TBL_NAME_Multi?Ticket=${n}`,{TBL_NAMES:["_STAY_STATUS"]});return T.My_Result.map((n=>({code:n.CODE_NAME,value:n.CODE_VALUE_EN})))}else{throw new Error("Invalid Token")}}catch(n){console.log(n)}}function s(T,E,_){const o=new Date(T);o.setHours(E);o.setMinutes(_);return`${t.entries.Lcz_BlockedTill} ${n(o).format("MMM DD, HH:mm")}`}function R(n,E){var t,_;if(T(n.STAY_STATUS_CODE)){return{ID:n.POOL,NOTES:"",BALANCE:"",NAME:n.My_Block_Info.NOTES!==""?n.My_Block_Info.NOTES:n.STAY_STATUS_CODE==="003"?s(n.My_Block_Info.BLOCKED_TILL_DATE,n.My_Block_Info.BLOCKED_TILL_HOUR,n.My_Block_Info.BLOCKED_TILL_MINUTE):E.find((T=>T.code===n.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:n.My_Block_Info.DESCRIPTION,PR_ID:n.My_Block_Info.pr_id,ENTRY_DATE:n.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:n.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:n.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:n.My_Block_Info.NOTES,FROM_DATE:n.DATE,TO_DATE:n.DATE,NO_OF_DAYS:1,STATUS:r[n.STAY_STATUS_CODE],POOL:n.POOL,STATUS_CODE:n.STAY_STATUS_CODE,OUT_OF_SERVICE:n.STAY_STATUS_CODE==="004",FROM_DATE_STR:n.My_Block_Info.format.from_date,TO_DATE_STR:n.My_Block_Info.format.to_date}}return{ID:n.POOL,TO_DATE:n.DATE,FROM_DATE:n.DATE,NO_OF_DAYS:1,STATUS:i[(t=n.booking)===null||t===void 0?void 0:t.status.code],NAME:e(n.room.guest.first_name,n.room.guest.last_name),IDENTIFIER:n.room.identifier,PR_ID:n.pr_id,POOL:n.POOL,BOOKING_NUMBER:n.booking.booking_nbr,NOTES:n.booking.remark,is_direct:n.booking.is_direct,BALANCE:(_=n.booking.financial)===null||_===void 0?void 0:_.due_amount,channel_booking_nbr:n.booking.channel_booking_nbr}}function D(n,T){n.NO_OF_DAYS=E(n.FROM_DATE,T.DATE);n.TO_DATE=T.DATE;if(T.booking){const{arrival:E}=T.booking;Object.assign(n,{ARRIVAL_TIME:E.description})}return n}function a(n,T,E){const t=T.findIndex((T=>T.POOL===n.POOL));if(t===-1){const t=R(n,E);T.push(t)}else{const E=D(T[t],n);T[t]=E}}function N(T){let E=[];const t=E=>{const t=n();const _=n(E.to_date,"YYYY-MM-DD");const o=n(E.from_date,"YYYY-MM-DD");if(o.isSame(t,"day")&&t.hour()>=12){return i["000"]}else if(t.isAfter(o,"day")&&t.isBefore(_,"day")){return i["000"]}else if(_.isSame(t,"day")&&t.hour()<12){return i["000"]}else if(_.isSame(t,"day")&&t.hour()>=12||_.isBefore(t,"day")){return i["003"]}else{return i[(T===null||T===void 0?void 0:T.status.code)||"001"]}};const _=T.rooms.filter((n=>!!n["assigned_units_pool"]));_.forEach((n=>{var _,o;E.push({ID:n["assigned_units_pool"],TO_DATE:n.to_date,FROM_DATE:n.from_date,NO_OF_DAYS:n.days.length,ARRIVAL:T.arrival,IS_EDITABLE:true,BALANCE:(_=T.financial)===null||_===void 0?void 0:_.due_amount,STATUS:t(n),NAME:e(n.guest.first_name,n.guest.last_name),PHONE:(o=T.guest.mobile)!==null&&o!==void 0?o:"",ENTRY_DATE:"12-12-2023",RATE:n.total,RATE_PLAN:n.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:n.rateplan.id,IDENTIFIER:n.identifier,RATE_TYPE:n.roomtype.id,ADULTS_COUNT:n.occupancy.adult_nbr,CHILDREN_COUNT:n.occupancy.children_nbr,PR_ID:+n.unit.id,POOL:n["assigned_units_pool"],GUEST:T.guest,ROOMS:T.rooms,BOOKING_NUMBER:T.booking_nbr,cancelation:n.rateplan.cancelation,guarantee:n.rateplan.guarantee,TOTAL_PRICE:n.total,COUNTRY:T.guest.country_id,FROM_DATE_STR:T.format.from_date,TO_DATE_STR:T.format.to_date,adult_child_offering:n.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:T.arrival.description,origin:T.origin,channel_booking_nbr:T.channel_booking_nbr,is_direct:T.is_direct,NOTES:T.remark,SOURCE:{code:T.source.code,description:T.source.description,tag:T.source.tag}})}));return E}async function S(n){const T=await c();return{ID:n.POOL,NOTES:"",BALANCE:"",NAME:n.NOTES!==""?n.NOTES:n.STAY_STATUS_CODE==="003"?s(n.BLOCKED_TILL_DATE,n.BLOCKED_TILL_HOUR,n.BLOCKED_TILL_MINUTE):T.find((T=>T.code===n.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:n.DESCRIPTION,PR_ID:n.pr_id,ENTRY_DATE:n.BLOCKED_TILL_DATE,ENTRY_HOUR:n.BLOCKED_TILL_HOUR,ENTRY_MINUTE:n.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:n.NOTES,FROM_DATE:n.from_date,TO_DATE:n.to_date,NO_OF_DAYS:u(n.from_date,n.to_date),STATUS:r[n.STAY_STATUS_CODE],POOL:n.POOL,STATUS_CODE:n.STAY_STATUS_CODE,OUT_OF_SERVICE:n.STAY_STATUS_CODE==="004",FROM_DATE_STR:n.format.from_date,TO_DATE_STR:n.format.to_date}}function u(T,E){const t=n(T,"YYYY-MM-DD");const _=n(E,"YYYY-MM-DD");const o=_.diff(t,"days");return o}export{N as a,i as b,u as c,e as f,O as g,S as t};
//# sourceMappingURL=p-0e97d53c.js.map