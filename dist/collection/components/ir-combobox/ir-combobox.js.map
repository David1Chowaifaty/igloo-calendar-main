{"version":3,"file":"ir-combobox.js","sourceRoot":"","sources":["../../../src/components/ir-combobox/ir-combobox.tsx"],"names":[],"mappings":"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","sourcesContent":["import { IToast } from '@/components';\nimport locales from '@/stores/locales.store';\nimport { Component, Prop, State, h, Element, Event, EventEmitter, Listen, Watch } from '@stencil/core';\n\n@Component({\n  tag: 'ir-combobox',\n  styleUrl: 'ir-combobox.css',\n  scoped: true,\n})\nexport class IrCombobox {\n  @Prop({ mutable: true }) data: { id: string; name: string }[] = [];\n  @Prop() duration: number = 300;\n  @Prop() placeholder: string;\n  @Prop() value: string;\n  @Prop() disabled: boolean = false;\n  @Prop() autoFocus: boolean = false;\n  @Prop() input_id: string = '';\n\n  @State() selectedIndex: number = -1;\n  @State() isComboBoxVisible: boolean = false;\n  @State() isLoading: boolean = true;\n  @State() isItemSelected: boolean;\n  @State() inputValue: string = '';\n  @State() filteredData: { id: string; name: string }[] = [];\n\n  @Element() el: HTMLElement;\n  @Event({ bubbles: true, composed: true }) comboboxValueChange: EventEmitter<{ key: string; data: unknown }>;\n  @Event() inputCleared: EventEmitter<null>;\n  @Event({ bubbles: true, composed: true }) toast: EventEmitter<IToast>;\n  @State() componentShouldAutoFocus: boolean = false;\n  private inputRef: HTMLInputElement;\n  private debounceTimer: any;\n  private blurTimout: NodeJS.Timeout;\n  componentWillLoad() {\n    this.filteredData = this.data;\n  }\n  componentDidLoad() {\n    if (this.autoFocus) {\n      this.focusInput();\n    }\n  }\n\n  @Watch('isComboBoxVisible')\n  watchHandler(newValue: boolean, oldValue: boolean) {\n    if (newValue !== oldValue && newValue === true) {\n      this.focusInput();\n    }\n  }\n  handleKeyDown(event: KeyboardEvent) {\n    const dataSize = this.data.length;\n    const itemHeight = this.getHeightOfPElement();\n    if (dataSize > 0) {\n      switch (event.key) {\n        case 'ArrowUp':\n          event.preventDefault();\n          this.selectedIndex = (this.selectedIndex - 1 + dataSize) % dataSize;\n          this.adjustScrollPosition(itemHeight);\n          break;\n        case 'ArrowDown':\n          event.preventDefault();\n          this.selectedIndex = (this.selectedIndex + 1) % dataSize;\n          this.adjustScrollPosition(itemHeight);\n          break;\n        // case 'Enter':\n        // case ' ':\n        // case 'ArrowRight':\n        //   event.preventDefault();\n        //   this.selectItem(this.selectedIndex);\n        //   break;\n        case 'Escape':\n          this.inputRef?.blur();\n          this.isComboBoxVisible = false;\n          break;\n      }\n    }\n  }\n  getHeightOfPElement() {\n    const combobox = this.el.querySelector('.combobox');\n    if (combobox) {\n      const pItem = combobox.querySelector('p');\n      return pItem ? pItem.offsetHeight : 0;\n    }\n    return 0;\n  }\n  focusInput() {\n    requestAnimationFrame(() => {\n      this.inputRef?.focus();\n    });\n  }\n  adjustScrollPosition(itemHeight, visibleHeight = 250) {\n    const combobox = this.el.querySelector('.combobox');\n    if (combobox) {\n      const margin = 2;\n      const itemTotalHeight = itemHeight + margin;\n      const selectedPosition = itemTotalHeight * this.selectedIndex;\n      let newScrollTop = selectedPosition - visibleHeight / 2 + itemHeight / 2;\n      newScrollTop = Math.max(0, Math.min(newScrollTop, combobox.scrollHeight - visibleHeight));\n      combobox.scrollTo({\n        top: newScrollTop,\n        behavior: 'auto',\n      });\n    }\n  }\n\n  selectItem(index) {\n    if (this.filteredData[index]) {\n      this.isItemSelected = true;\n      this.comboboxValueChange.emit({ key: 'select', data: this.filteredData[index].id });\n      this.inputValue = '';\n      this.resetCombobox();\n      if (this.autoFocus) {\n        this.focusInput();\n      }\n    }\n  }\n\n  debounceFetchData() {\n    clearTimeout(this.debounceTimer);\n    this.debounceTimer = setTimeout(() => {\n      this.fetchData();\n    }, this.duration);\n  }\n  handleFocus() {\n    this.isComboBoxVisible = true;\n  }\n  clearInput() {\n    this.inputValue = '';\n    this.resetCombobox();\n    this.inputCleared.emit(null);\n  }\n  resetCombobox(withblur: boolean = true) {\n    if (withblur) {\n      this.inputRef?.blur();\n    }\n    this.selectedIndex = -1;\n    this.isComboBoxVisible = false;\n  }\n  async fetchData() {\n    try {\n      this.isLoading = true;\n      this.filteredData = this.data.filter(d => d.name.toLowerCase().startsWith(this.inputValue));\n    } catch (error) {\n      console.log('error', error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  handleInputChange(event: Event) {\n    this.inputValue = (event.target as HTMLInputElement).value;\n    if (this.inputValue) {\n      this.debounceFetchData();\n    } else {\n      this.filteredData = this.data;\n    }\n  }\n\n  @Listen('click', { target: 'document' })\n  handleDocumentClick(event: MouseEvent) {\n    const target = event.target as HTMLElement;\n    if (!this.el.contains(target)) {\n      this.isComboBoxVisible = false;\n    }\n  }\n\n  handleBlur() {\n    this.blurTimout = setTimeout(() => {\n      if (!this.isItemSelected) {\n        this.inputValue = '';\n        this.resetCombobox();\n      } else {\n        this.isItemSelected = false;\n      }\n    }, 300);\n  }\n  isDropdownItem(element) {\n    return element && element.closest('.combobox');\n  }\n\n  disconnectedCallback() {\n    clearTimeout(this.debounceTimer);\n    clearTimeout(this.blurTimout);\n    this.inputRef?.removeEventListener('blur', this.handleBlur);\n    this.inputRef?.removeEventListener('click', this.selectItem);\n    this.inputRef?.removeEventListener('keydown', this.handleKeyDown);\n    this.inputRef?.removeEventListener('focus', this.handleFocus);\n  }\n  handleItemKeyDown(event: KeyboardEvent, index: number) {\n    if (event.key === 'Enter' || event.key === ' ' || event.key === 'ArrowRight') {\n      this.selectItem(index);\n      event.preventDefault();\n    } else if (event.key === 'Escape') {\n      this.isComboBoxVisible = false;\n      this.inputRef?.blur();\n      event.preventDefault();\n    }\n  }\n  renderDropdown() {\n    if (!this.isComboBoxVisible) {\n      return null;\n    }\n    return (\n      <ul>\n        {this.filteredData?.map((d, index) => (\n          <li\n            role=\"button\"\n            key={d.id}\n            onKeyDown={e => this.handleItemKeyDown(e, index)}\n            data-selected={this.selectedIndex === index}\n            tabIndex={0}\n            onClick={() => this.selectItem(index)}\n          >\n            {d.name}\n          </li>\n        ))}\n\n        {this.filteredData.length === 0 && !this.isLoading && <span class={'text-center'}>{locales.entries.Lcz_NoResultsFound}</span>}\n      </ul>\n    );\n  }\n  handleSubmit(e: Event) {\n    e.preventDefault();\n    e.stopPropagation();\n    console.log('object');\n    if (!this.filteredData.length) {\n      return;\n    }\n    this.selectItem(this.selectedIndex === -1 ? 0 : this.selectedIndex);\n  }\n  render() {\n    return (\n      <form onSubmit={this.handleSubmit.bind(this)} class=\"m-0 p-0\">\n        <input\n          id={this.input_id}\n          ref={el => (this.inputRef = el)}\n          type=\"text\"\n          disabled={this.disabled}\n          value={this.value}\n          placeholder={this.placeholder}\n          class=\"form-control bg-white\"\n          onKeyDown={this.handleKeyDown.bind(this)}\n          onBlur={this.handleBlur.bind(this)}\n          onInput={this.handleInputChange.bind(this)}\n          onFocus={this.handleFocus.bind(this)}\n          autoFocus={this.autoFocus}\n        />\n        {this.renderDropdown()}\n      </form>\n    );\n  }\n}\n"]}