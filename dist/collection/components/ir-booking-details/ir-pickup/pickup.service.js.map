{"version":3,"file":"pickup.service.js","sourceRoot":"","sources":["../../../../src/components/ir-booking-details/ir-pickup/pickup.service.ts"],"names":[],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport { TDueParams, TPickupData } from './types';\nimport calendar_data from '@/stores/calendar-data';\nimport { IBookingPickupInfo } from '@/components';\n\nexport class PickupService {\n  token: string | null;\n  constructor() {\n    this.token = JSON.parse(sessionStorage.getItem('token'));\n  }\n  public async savePickup(params: TPickupData, booking_nbr: string, is_remove: boolean) {\n    try {\n      const splitTime = params.arrival_time.split(':');\n      await axios.post(`/Do_Pickup?Ticket=${this.token}`, {\n        booking_nbr,\n        is_remove,\n        currency: params.currency,\n        date: params.arrival_date,\n        details: params.flight_details,\n        hour: splitTime[0],\n        minute: splitTime[1],\n        nbr_of_units: params.number_of_vehicles,\n        selected_option: params.selected_option,\n        total: +params.due_upon_booking,\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  public transformDefaultPickupData(data: IBookingPickupInfo): TPickupData {\n    return {\n      arrival_date: data.date,\n      arrival_time: data.hour + ':' + data.minute,\n      currency: data.currency,\n      due_upon_booking: data.total.toFixed(2),\n      flight_details: data.details,\n      location: data.selected_option.location.id,\n      number_of_vehicles: data.nbr_of_units,\n      selected_option: data.selected_option,\n      vehicle_type_code: data.selected_option.vehicle.code,\n    };\n  }\n  public getAvailableLocations(message: string) {\n    let locations: { value: number; text: string }[] = [];\n    calendar_data.pickup_service.allowed_options.forEach(option => {\n      if (locations.filter(location => location.value === option.location.id).length === 0) {\n        locations.push({\n          text: message + ' ' + option.location.description,\n          value: option.location.id,\n        });\n      }\n    });\n    return locations;\n  }\n  public validateForm(params: TPickupData): { error: boolean; cause?: keyof TPickupData } {\n    if (params.arrival_time.split(':').length !== 2) {\n      return {\n        error: true,\n        cause: 'arrival_time',\n      };\n    }\n    if (params.flight_details === '') {\n      return {\n        error: true,\n        cause: 'flight_details',\n      };\n    }\n    if (params.vehicle_type_code === '') {\n      return {\n        error: true,\n        cause: 'vehicle_type_code',\n      };\n    }\n    if (params.number_of_vehicles === 0) {\n      return {\n        error: true,\n        cause: 'number_of_vehicles',\n      };\n    }\n    return { error: false };\n  }\n  public getNumberOfVehicles(capacity: number, numberOfPersons: number) {\n    let total_number_of_vehicles = Math.ceil(numberOfPersons / capacity);\n    let startNumber = total_number_of_vehicles > 1 ? total_number_of_vehicles : 1;\n    let bonus_number = total_number_of_vehicles > 1 ? 2 : 3;\n    return Array.from({ length: total_number_of_vehicles + bonus_number }, (_, i) => startNumber + i);\n  }\n  private getPickUpPersonStatus(code: string) {\n    const getCodeDescription = calendar_data.pickup_service.allowed_pricing_models.find(model => model.code === code);\n    if (!getCodeDescription) {\n      return null;\n    }\n    return getCodeDescription.description;\n  }\n  public updateDue(params: TDueParams) {\n    const getCodeDescription = this.getPickUpPersonStatus(params.code);\n    if (!getCodeDescription) {\n      return;\n    }\n    if (getCodeDescription === 'Person') {\n      return params.amount * params.numberOfPersons;\n    } else {\n      return params.amount * params.number_of_vehicles;\n    }\n  }\n}\n"]}